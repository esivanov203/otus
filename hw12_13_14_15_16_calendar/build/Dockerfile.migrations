FROM golang:1.24 as build

RUN go install github.com/pressly/goose/v3/cmd/goose@latest


FROM alpine:3.19

RUN apk add --no-cache libc6-compat
COPY --from=build /go/bin/goose /usr/local/bin/goose

WORKDIR /migrations
COPY migrations .

ENTRYPOINT ["sh", "-c", \
  "goose postgres \"postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?sslmode=disable\" up"]
